import{r as e,j as s,m as a,A as t}from"./chunk-DQeWIckh.js";import{u as l,c as i,p as n,F as c,O as r,P as x,Q as d,M as o,N as m}from"./index-7-sGh0Fr.js";import"./chunk-BI3NJeJA.js";import"./chunk-MJnNx1Rr.js";import"./chunk-BGx2W5xE.js";const p=()=>{const{rankingManager:p,progressManager:h}=l(),[j,y]=e.useState("daily"),[g,u]=e.useState(null),[b,N]=e.useState(0),[f,v]=e.useState(!1);e.useEffect(()=>{const e=p.getRankings();u(e);const s=h.getProgress(),a=p.getPlayerRank(s.playerName,j);N(a)},[j,p,h]);const w=e=>{switch(e){case 1:return s.jsx(m,{className:"text-yellow-400"});case 2:return s.jsx(o,{className:"text-gray-400"});case 3:return s.jsx(o,{className:"text-orange-400"});default:return s.jsxs("span",{className:"text-gray-600",children:["#",e]})}},k=e=>{switch(e){case"daily":return s.jsx(d,{});case"weekly":return s.jsx(x,{});case"all_time":return s.jsx(r,{})}},S=e=>{switch(e){case"daily":return"デイリー";case"weekly":return"ウィークリー";case"all_time":return"全期間"}},R=(()=>{if(!g)return[];switch(j){case"daily":return g.dailyRankings;case"weekly":return g.weeklyRankings;case"all_time":return g.allTimeRankings}})();return s.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-4xl mx-auto p-4",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center",children:[s.jsx(i,{className:"text-yellow-400 mr-3"}),"ランキング"]}),s.jsxs("button",{onClick:()=>{v(!0);try{const e=p.exportRankingCSV(j),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),t=URL.createObjectURL(s);a.href=t,a.download=`ranking_${j}_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}catch(e){}finally{v(!1)}},disabled:f,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 transition-colors",children:[s.jsx(n,{}),s.jsx("span",{children:"CSV出力"})]})]}),s.jsx("div",{className:"flex space-x-2 mb-6",children:["daily","weekly","all_time"].map(e=>s.jsxs("button",{onClick:()=>y(e),className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-colors "+(j===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[k(e),s.jsx("span",{children:S(e)})]},e))}),b>0&&s.jsx(a.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-4 mb-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(c,{className:"text-blue-600 text-2xl"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"あなたの順位"}),s.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[b,"位"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-gray-600",children:h.getProgress().playerName}),s.jsxs("p",{className:"text-lg font-semibold",children:["スコア: ",R.find(e=>e.playerName===h.getProgress().playerName)?.score||0]})]})]})}),s.jsx("div",{className:"space-y-2",children:s.jsx(t,{mode:"popLayout",children:0===R.length?s.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center py-12 text-gray-500",children:[s.jsx(i,{className:"text-6xl mb-4 mx-auto opacity-20"}),s.jsx("p",{children:"まだランキングデータがありません"}),s.jsx("p",{className:"text-sm mt-2",children:"クイズに挑戦してランキングに載ろう！"})]}):R.map((e,t)=>{const l=t+1,i=e.playerName===h.getProgress().playerName;return s.jsxs(a.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.05*t},className:"flex items-center space-x-4 p-4 rounded-lg transition-colors "+(i?"bg-blue-50 border-2 border-blue-300":"bg-gray-50 hover:bg-gray-100"),children:[s.jsx("div",{className:"w-12 text-center text-2xl font-bold",children:w(l)}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("p",{className:"font-semibold "+(i?"text-blue-600":"text-gray-800"),children:e.playerName}),i&&s.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded",children:"YOU"})]}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[s.jsxs("span",{children:["Lv.",e.level]}),s.jsxs("span",{children:["正答率: ",e.accuracy,"%"]}),s.jsxs("span",{children:["モンスター: ",e.monstersCollected,"体"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-2xl font-bold text-gray-800",children:e.score.toLocaleString()}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.dateAchieved).toLocaleDateString("ja-JP")})]})]},e.id)})})}),g&&s.jsxs("p",{className:"text-center text-sm text-gray-500 mt-6",children:["最終更新: ",new Date(g.lastUpdated).toLocaleString("ja-JP")]})]}),s.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"スコア計算方法"}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"正解数 × 100"}),s.jsx("span",{className:"font-semibold",children:"基本スコア"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"正答率 × 1000"}),s.jsx("span",{className:"font-semibold",children:"正確性ボーナス"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"レベル × 50"}),s.jsx("span",{className:"font-semibold",children:"レベルボーナス"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"モンスター数 × 25"}),s.jsx("span",{className:"font-semibold",children:"コレクションボーナス"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"連続正解数 × 10"}),s.jsx("span",{className:"font-semibold",children:"コンボボーナス"})]})]})]})]})};export{p as RankingScreen};
