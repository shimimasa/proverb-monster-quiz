import{j as e,r as a,m as t,A as s}from"./chunk-DQeWIckh.js";import{Z as r,a as i,$ as l,b as c,Y as d,R as n,p as o,V as x}from"./index-DDmePrOZ.js";import{R as h,A as m,C as y,X as j,Y as p,T as u,L as g,a as b,b as N,c as f,P as w,d as v,e as k,B as $,f as A}from"./chunk-C7hMPJIR.js";import"./chunk-BI3NJeJA.js";import"./chunk-MJnNx1Rr.js";import"./chunk-BGx2W5xE.js";const K=({chartType:a,data:t,description:s,title:r})=>e.jsxs("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[e.jsx("h3",{children:r}),e.jsx("p",{children:s}),e.jsxs("p",{children:["データ: ",(()=>{switch(a){case"pie":return t.map(e=>`${e.name}: ${e.value}件 (${e.accuracy}%正答率)`).join(", ");case"bar":return t.map(e=>`${e.type||e.name}: ${e.accuracy}%正答率`).join(", ");case"line":case"area":return t.map(e=>`${e.date||e.month}: ${e.questions}問, ${e.correct}問正解, ${e.accuracy}%正答率`).join(", ");default:return s}})()]})]}),S=({children:a})=>e.jsx("caption",{className:"sr-only",children:a}),T="#3B82F6",C="#10B981",q="#8B5CF6",D={proverb:T,idiom:C,four_character_idiom:"#F59E0B"},I={proverb:"ことわざ",idiom:"慣用句",four_character_idiom:"四字熟語"},L=()=>{const[L,O]=a.useState(null),[R,B]=a.useState("weekly");a.useEffect(()=>{H()},[]);const H=()=>{const e=r.getStats();O(e)};if(!L)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(t.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"text-4xl",children:"📊"})});const P=L.dailyHistory.map(e=>({date:e.date.toLocaleDateString("ja-JP",{month:"short",day:"numeric"}),questions:e.questionsAnswered,correct:e.correctAnswers,accuracy:e.accuracy})),_=L.categoryPerformance.filter(e=>e.totalQuestions>0).map(e=>({name:I[e.type],value:e.totalQuestions,accuracy:e.accuracy})),F=L.monthlyTrends.map(e=>({month:e.month.split(" ")[1],accuracy:e.accuracy,questions:e.questionsAnswered}));return e.jsxs("main",{className:"space-y-6",role:"main","aria-label":"統計画面",children:[e.jsxs(t.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 mb-4 flex items-center gap-3",children:[e.jsx(i,{className:"text-blue-500","aria-hidden":"true"}),"学習統計"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",role:"region","aria-label":"サマリー情報",children:[e.jsx(t.div,{whileHover:{scale:1.05},className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"週間正答率"}),e.jsxs("p",{className:"text-2xl font-bold",children:[L.weeklyStats.averageAccuracy,"%"]})]}),e.jsx(l,{className:"text-3xl opacity-80","aria-hidden":"true"})]})}),e.jsx(t.div,{whileHover:{scale:1.05},className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"週間問題数"}),e.jsx("p",{className:"text-2xl font-bold",children:L.weeklyStats.totalQuestions})]}),e.jsx(c,{className:"text-3xl opacity-80","aria-hidden":"true"})]})}),e.jsx(t.div,{whileHover:{scale:1.05},className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"学習時間"}),e.jsxs("p",{className:"text-2xl font-bold",children:[L.weeklyStats.totalStudyTime,"分"]})]}),e.jsx(d,{className:"text-3xl opacity-80","aria-hidden":"true"})]})}),e.jsx(t.div,{whileHover:{scale:1.05},className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"最も活発"}),e.jsx("p",{className:"text-lg font-bold",children:L.weeklyStats.mostActiveDay||"-"})]}),e.jsx(n,{className:"text-3xl opacity-80","aria-hidden":"true"})]})})]})]}),e.jsx("section",{className:"bg-white rounded-lg shadow-md p-4","aria-label":"期間選択",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",role:"group","aria-label":"表示期間",children:[e.jsx("button",{onClick:()=>B("daily"),className:"px-4 py-2 rounded-lg transition-colors "+("daily"===R?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),"aria-pressed":"daily"===R,children:"日別"}),e.jsx("button",{onClick:()=>B("weekly"),className:"px-4 py-2 rounded-lg transition-colors "+("weekly"===R?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),"aria-pressed":"weekly"===R,children:"週間"}),e.jsx("button",{onClick:()=>B("monthly"),className:"px-4 py-2 rounded-lg transition-colors "+("monthly"===R?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),"aria-pressed":"monthly"===R,children:"月別"})]}),e.jsxs("button",{onClick:()=>{const e=r.exportHistory(),a=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`learning_history_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors","aria-label":"学習データをエクスポート",children:[e.jsx(o,{"aria-hidden":"true"}),"データエクスポート"]})]})}),e.jsxs(s,{mode:"wait",children:["daily"===R&&e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(x,{className:"text-blue-500","aria-hidden":"true"}),"日別学習進捗"]}),e.jsx(K,{chartType:"area",data:P,title:"日別学習進捗チャート",description:"日ごとの問題数と正解数の推移を表示"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs(m,{data:P,"aria-label":"日別学習進捗チャート",children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"date"}),e.jsx(p,{}),e.jsx(u,{}),e.jsx(g,{}),e.jsx(b,{type:"monotone",dataKey:"questions",stackId:"1",stroke:T,fill:T,fillOpacity:.6,name:"問題数"}),e.jsx(b,{type:"monotone",dataKey:"correct",stackId:"2",stroke:C,fill:C,fillOpacity:.6,name:"正解数"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"正答率推移"}),e.jsx(K,{chartType:"line",data:P,title:"正答率推移チャート",description:"日ごとの正答率の推移を表示"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs(N,{data:P,"aria-label":"正答率推移チャート",children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"date"}),e.jsx(p,{domain:[0,100]}),e.jsx(u,{formatter:e=>`${e}%`}),e.jsx(g,{}),e.jsx(f,{type:"monotone",dataKey:"accuracy",stroke:q,strokeWidth:3,dot:{fill:q},name:"正答率"})]})})]})]},"daily"),"weekly"===R&&e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"カテゴリ別成績"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(K,{chartType:"pie",data:_,title:"カテゴリ別問題数分布",description:"各カテゴリの問題数の割合を表示"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs(w,{"aria-label":"カテゴリ別問題数分布",children:[e.jsx(v,{data:_,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.value}問`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:_.map((a,t)=>e.jsx(k,{fill:Object.values(D)[t%Object.values(D).length]},`cell-${t}`))}),e.jsx(u,{})]})})]}),e.jsxs("div",{children:[e.jsx(K,{chartType:"bar",data:L.categoryPerformance,title:"カテゴリ別正答率",description:"各カテゴリの正答率を表示"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs($,{data:L.categoryPerformance,"aria-label":"カテゴリ別正答率",children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"type",tickFormatter:e=>I[e]}),e.jsx(p,{domain:[0,100]}),e.jsx(u,{formatter:(e,a)=>"正答率"===a?`${e}%`:e}),e.jsx(g,{}),e.jsx(A,{dataKey:"accuracy",fill:C,name:"正答率"})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"カテゴリ別詳細"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",role:"table","aria-label":"カテゴリ別成績詳細",children:[e.jsx(S,{children:"各カテゴリの問題数、正解数、正答率、平均時間を表示"}),e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"カテゴリ"}),e.jsx("th",{className:"text-center py-2",children:"問題数"}),e.jsx("th",{className:"text-center py-2",children:"正解数"}),e.jsx("th",{className:"text-center py-2",children:"正答率"}),e.jsx("th",{className:"text-center py-2",children:"平均時間"})]})}),e.jsx("tbody",{children:L.categoryPerformance.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 font-medium",children:I[a.type]}),e.jsx("td",{className:"text-center",children:a.totalQuestions}),e.jsx("td",{className:"text-center",children:a.correctAnswers}),e.jsx("td",{className:"text-center",children:e.jsxs("span",{className:"font-bold "+(a.accuracy>=80?"text-green-600":a.accuracy>=60?"text-yellow-600":"text-red-600"),children:[a.accuracy,"%"]})}),e.jsxs("td",{className:"text-center",children:[a.averageTime,"分"]})]},a.type))})]})})]})]},"weekly"),"monthly"===R&&e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"月別トレンド"}),e.jsx(K,{chartType:"line",data:F,title:"月別トレンドチャート",description:"月ごとの正答率と問題数の推移を表示"}),e.jsx(h,{width:"100%",height:400,children:e.jsxs(N,{data:F,"aria-label":"月別トレンドチャート",children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"month"}),e.jsx(p,{yAxisId:"left",domain:[0,100]}),e.jsx(p,{yAxisId:"right",orientation:"right"}),e.jsx(u,{}),e.jsx(g,{}),e.jsx(f,{yAxisId:"left",type:"monotone",dataKey:"accuracy",stroke:q,strokeWidth:3,name:"正答率 (%)"}),e.jsx(f,{yAxisId:"right",type:"monotone",dataKey:"questions",stroke:T,strokeWidth:3,name:"問題数"})]})})]},"monthly")]})]})};export{L as StatsScreen};
