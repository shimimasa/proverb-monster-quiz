import{r as e,j as t,m as s}from"./chunk-DQeWIckh.js";import{u as n,r as a,a0 as i,X as r,p as o,A as l,a1 as c,E as g,a2 as d,a3 as p,c as x}from"./index-BTFQCUw4.js";import"./chunk-BI3NJeJA.js";import"./chunk-MJnNx1Rr.js";import"./chunk-BGx2W5xE.js";class m{progressManager;monsterManager;rankingManager;learningHistoryManager;constructor(e,t,s,n){this.progressManager=e,this.monsterManager=t,this.rankingManager=s,this.learningHistoryManager=n}exportAllDataAsJSON(){const e={exportDate:(new Date).toISOString(),version:"1.0.0",progress:this.progressManager.getProgress(),monsters:this.monsterManager.getCollection(),rankings:this.rankingManager.getRankings(),learningHistory:this.learningHistoryManager.getFullHistory(),settings:this.progressManager.getProgress().settings};return JSON.stringify(e,null,2)}exportLearningHistoryCSV(){const e=this.learningHistoryManager.getRecentSessions(1e3).flatMap(e=>e.answers.map((t,s)=>{const n=e.questions[s];return[new Date(t.answeredAt).toLocaleString("ja-JP"),n.contentItem.type,n.contentItem.text,t.isCorrect?"正解":"不正解",(t.timeSpent/1e3).toFixed(1),n.choices[t.selectedChoice],n.choices[n.correctAnswer]]}));return this.convertToCSV(["日時","問題タイプ","コンテンツ","正解/不正解","回答時間(秒)","選択肢","正解"],e)}exportMonsterCollectionCSV(){const e=this.monsterManager.getCollection().filter(e=>e.unlocked).map(e=>[e.id,e.name,this.getRarityJapanese(e.rarity),e.dateObtained?new Date(e.dateObtained).toLocaleString("ja-JP"):"未取得",e.sourceContent.text,this.getContentTypeJapanese(e.sourceContent.type)]);return this.convertToCSV(["ID","名前","レアリティ","取得日","ソースコンテンツ","タイプ"],e)}exportRankingCSV(e){return this.rankingManager.exportRankingCSV(e)}exportStatisticsCSV(){const e=this.progressManager.getProgress(),t=this.progressManager.getDetailedStats(),s=this.learningHistoryManager.getDailyStats(30),n=[["レベル",e.level.toString()],["経験値",e.experience.toString()],["総問題数",e.totalQuestions.toString()],["正解数",e.correctAnswers.toString()],["正答率",`${t.accuracy}%`],["連続正解数",e.streak.toString()],["最大連続正解数",t.maxStreak.toString()],["獲得モンスター数",t.monstersUnlocked.toString()],["総プレイ時間",`${Math.floor(t.totalPlayTime/60)}分`],["平均回答時間",`${t.averageAnswerTime.toFixed(1)}秒`],["アチーブメント達成数",t.achievementsUnlocked.toString()]];return s.forEach(e=>{n.push([`${e.date}の正解数`,e.correctAnswers.toString()])}),this.convertToCSV(["項目","値"],n)}exportAchievementsCSV(){const e=this.progressManager.getProgress().achievements.map(e=>[e.id,e.name,e.description,e.unlocked?"達成":"未達成",e.dateUnlocked?new Date(e.dateUnlocked).toLocaleString("ja-JP"):"-"]);return this.convertToCSV(["ID","名前","説明","達成状態","達成日"],e)}exportContentTypeStatsCSV(){const e=this.learningHistoryManager.getContentTypeStats(),t=Object.entries(e).map(([e,t])=>[this.getContentTypeJapanese(e),t.totalQuestions.toString(),t.correctAnswers.toString(),`${t.accuracy}%`,`${t.averageAnswerTime.toFixed(1)}秒`]);return this.convertToCSV(["コンテンツタイプ","総問題数","正解数","正答率","平均回答時間"],t)}exportSettingsJSON(){const e=this.progressManager.getProgress().settings,t={exportDate:(new Date).toISOString(),settings:e};return JSON.stringify(t,null,2)}convertToCSV(e,t){return[e.map(e=>this.escapeCSV(e)).join(","),...t.map(e=>e.map(e=>this.escapeCSV(e.toString())).join(","))].join("\n")}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}getRarityJapanese(e){return{common:"コモン",rare:"レア",epic:"エピック",legendary:"レジェンド"}[e]||e}getContentTypeJapanese(e){return{proverb:"ことわざ",four_character_idiom:"四字熟語",idiom:"慣用句"}[e]||e}generateFileName(e,t){const s=new Date;return`${e}_${s.toISOString().split("T")[0].replace(/-/g,"")}_${s.toTimeString().split(" ")[0].replace(/:/g,"")}.${t}`}}const h=()=>{const{progressManager:h,monsterManager:S}=n(),[u]=e.useState(()=>new m(h,S)),[y,b]=e.useState(null),[j,v]=e.useState(new Set),C=[{id:"all-data",title:"h���",description:"Yyfn�������JSONbg������",icon:t.jsx(l,{className:"text-2xl"}),format:"json",action:()=>{const e=u.exportAllData(),t=`kotodama-monster-all-data_${(new Date).toISOString().split("T")[0]}.json`;u.downloadFile(e,t,"application/json")}},{id:"learning-history",title:"f�et",description:"�÷��Thnf�2�CSVbg������",icon:t.jsx(c,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportLearningHistoryCSV(),t=`learning-history_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"monster-collection",title:"����쯷��",description:"r�W_���n\0��CSVbg������",icon:t.jsx(g,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportMonsterCollectionCSV(),t=`monster-collection_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"statistics",title:"q\b�1",description:"f�>nq\b����CSVbg������",icon:t.jsx(d,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportStatisticsCSV(),t=`statistics_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"daily-activity",title:"�%;�2",description:"�Thnf�;ՒCSVbg������",icon:t.jsx(p,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportDailyActivityCSV(),t=`daily-activity_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"content-stats",title:"�����%q\b",description:"Sh�V��W���c(�%n>�CSVbg������",icon:t.jsx(x,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportContentTypeStatsCSV(),t=`content-type-stats_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"backup",title:"�ï������",description:"�������jbg�ï��ג",icon:t.jsx(a,{className:"text-2xl"}),format:"json",action:()=>{const e=u.createBackup(),t=`kotodama-monster-backup_${(new Date).toISOString().split("T")[0]}.json`;u.downloadFile(e,t,"application/json")}}];return t.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-4xl mx-auto p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-800 mb-2 flex items-center",children:[t.jsx(a,{className:"mr-3 text-blue-600"}),"���������"]}),t.jsx("p",{className:"text-gray-600 mb-6",children:"f��������n2W�������Wf�g�W_��XW_�gM~Y"}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:C.map(e=>t.jsxs(s.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"relative",children:[t.jsx("button",{onClick:()=>(async e=>{b(e.id);try{await new Promise(e=>setTimeout(e,500)),e.action(),v(t=>new Set([...t,e.id])),setTimeout(()=>{v(t=>{const s=new Set(t);return s.delete(e.id),s})},3e3)}catch(t){}finally{b(null)}})(e),disabled:null!==y,className:`w-full p-4 rounded-lg border-2 transition-all ${y===e.id?"border-blue-400 bg-blue-50":j.has(e.id)?"border-green-400 bg-green-50":"border-gray-200 hover:border-blue-300 hover:shadow-md bg-white"} ${null!==y&&y!==e.id?"opacity-50":""}`,children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"p-3 rounded-lg "+(y===e.id?"bg-blue-200 text-blue-700":j.has(e.id)?"bg-green-200 text-green-700":"bg-gray-100 text-gray-700"),children:y===e.id?t.jsx(i,{className:"text-2xl animate-spin"}):j.has(e.id)?t.jsx(r,{className:"text-2xl"}):e.icon}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h3",{className:"font-semibold text-gray-800",children:e.title}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),t.jsxs("span",{className:"inline-block mt-2 px-2 py-1 text-xs rounded "+("json"===e.format?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"),children:[e.format.toUpperCase(),"b"]})]})]})}),t.jsx(AnimatePresence,{children:j.has(e.id)&&t.jsx(s.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-2",children:t.jsx(r,{})})})]},e.id))}),t.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-blue-800 mb-2 flex items-center",children:[t.jsx(o,{className:"mr-2"}),"���������kdDf"]}),t.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[t.jsx("li",{children:"CSVbnա��oExcel�Google����ɷ��g�OShLgM~Y"}),t.jsx("li",{children:"JSONbnա��o�����gn���ï���kiWfD~Y"}),t.jsx("li",{children:"������U�_���ko\v��1o+~�~[�"}),t.jsx("li",{children:"�ï������oen�����_�g�C��gY"})]})]})]})})};export{h as ExportScreen};
