import{r as e,j as t,m as s}from"./chunk-DQeWIckh.js";import{u as n,r as a,a0 as i,X as r,p as o,A as l,a1 as c,E as g,a2 as d,a3 as p,c as x}from"./index-BTFQCUw4.js";import"./chunk-BI3NJeJA.js";import"./chunk-MJnNx1Rr.js";import"./chunk-BGx2W5xE.js";class m{progressManager;monsterManager;rankingManager;learningHistoryManager;constructor(e,t,s,n){this.progressManager=e,this.monsterManager=t,this.rankingManager=s,this.learningHistoryManager=n}exportAllDataAsJSON(){const e={exportDate:(new Date).toISOString(),version:"1.0.0",progress:this.progressManager.getProgress(),monsters:this.monsterManager.getCollection(),rankings:this.rankingManager.getRankings(),learningHistory:this.learningHistoryManager.getFullHistory(),settings:this.progressManager.getProgress().settings};return JSON.stringify(e,null,2)}exportLearningHistoryCSV(){const e=this.learningHistoryManager.getRecentSessions(1e3).flatMap(e=>e.answers.map((t,s)=>{const n=e.questions[s];return[new Date(t.answeredAt).toLocaleString("ja-JP"),n.contentItem.type,n.contentItem.text,t.isCorrect?"æ­£è§£":"ä¸æ­£è§£",(t.timeSpent/1e3).toFixed(1),n.choices[t.selectedChoice],n.choices[n.correctAnswer]]}));return this.convertToCSV(["æ—¥æ™‚","å•é¡Œã‚¿ã‚¤ãƒ—","ã‚³ãƒ³ãƒ†ãƒ³ãƒ„","æ­£è§£/ä¸æ­£è§£","å›žç­”æ™‚é–“(ç§’)","é¸æŠžè‚¢","æ­£è§£"],e)}exportMonsterCollectionCSV(){const e=this.monsterManager.getCollection().filter(e=>e.unlocked).map(e=>[e.id,e.name,this.getRarityJapanese(e.rarity),e.dateObtained?new Date(e.dateObtained).toLocaleString("ja-JP"):"æœªå–å¾—",e.sourceContent.text,this.getContentTypeJapanese(e.sourceContent.type)]);return this.convertToCSV(["ID","åå‰","ãƒ¬ã‚¢ãƒªãƒ†ã‚£","å–å¾—æ—¥","ã‚½ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„","ã‚¿ã‚¤ãƒ—"],e)}exportRankingCSV(e){return this.rankingManager.exportRankingCSV(e)}exportStatisticsCSV(){const e=this.progressManager.getProgress(),t=this.progressManager.getDetailedStats(),s=this.learningHistoryManager.getDailyStats(30),n=[["ãƒ¬ãƒ™ãƒ«",e.level.toString()],["çµŒé¨“å€¤",e.experience.toString()],["ç·å•é¡Œæ•°",e.totalQuestions.toString()],["æ­£è§£æ•°",e.correctAnswers.toString()],["æ­£ç­”çŽ‡",`${t.accuracy}%`],["é€£ç¶šæ­£è§£æ•°",e.streak.toString()],["æœ€å¤§é€£ç¶šæ­£è§£æ•°",t.maxStreak.toString()],["ç²å¾—ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼æ•°",t.monstersUnlocked.toString()],["ç·ãƒ—ãƒ¬ã‚¤æ™‚é–“",`${Math.floor(t.totalPlayTime/60)}åˆ†`],["å¹³å‡å›žç­”æ™‚é–“",`${t.averageAnswerTime.toFixed(1)}ç§’`],["ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆé”æˆæ•°",t.achievementsUnlocked.toString()]];return s.forEach(e=>{n.push([`${e.date}ã®æ­£è§£æ•°`,e.correctAnswers.toString()])}),this.convertToCSV(["é …ç›®","å€¤"],n)}exportAchievementsCSV(){const e=this.progressManager.getProgress().achievements.map(e=>[e.id,e.name,e.description,e.unlocked?"é”æˆ":"æœªé”æˆ",e.dateUnlocked?new Date(e.dateUnlocked).toLocaleString("ja-JP"):"-"]);return this.convertToCSV(["ID","åå‰","èª¬æ˜Ž","é”æˆçŠ¶æ…‹","é”æˆæ—¥"],e)}exportContentTypeStatsCSV(){const e=this.learningHistoryManager.getContentTypeStats(),t=Object.entries(e).map(([e,t])=>[this.getContentTypeJapanese(e),t.totalQuestions.toString(),t.correctAnswers.toString(),`${t.accuracy}%`,`${t.averageAnswerTime.toFixed(1)}ç§’`]);return this.convertToCSV(["ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—","ç·å•é¡Œæ•°","æ­£è§£æ•°","æ­£ç­”çŽ‡","å¹³å‡å›žç­”æ™‚é–“"],t)}exportSettingsJSON(){const e=this.progressManager.getProgress().settings,t={exportDate:(new Date).toISOString(),settings:e};return JSON.stringify(t,null,2)}convertToCSV(e,t){return[e.map(e=>this.escapeCSV(e)).join(","),...t.map(e=>e.map(e=>this.escapeCSV(e.toString())).join(","))].join("\n")}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}getRarityJapanese(e){return{common:"ã‚³ãƒ¢ãƒ³",rare:"ãƒ¬ã‚¢",epic:"ã‚¨ãƒ”ãƒƒã‚¯",legendary:"ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰"}[e]||e}getContentTypeJapanese(e){return{proverb:"ã“ã¨ã‚ã–",four_character_idiom:"å››å­—ç†Ÿèªž",idiom:"æ…£ç”¨å¥"}[e]||e}generateFileName(e,t){const s=new Date;return`${e}_${s.toISOString().split("T")[0].replace(/-/g,"")}_${s.toTimeString().split(" ")[0].replace(/:/g,"")}.${t}`}}const h=()=>{const{progressManager:h,monsterManager:S}=n(),[u]=e.useState(()=>new m(h,S)),[y,b]=e.useState(null),[j,v]=e.useState(new Set),C=[{id:"all-data",title:"hï¿½ï¿½ï¿½",description:"Yyfnï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½JSONbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(l,{className:"text-2xl"}),format:"json",action:()=>{const e=u.exportAllData(),t=`kotodama-monster-all-data_${(new Date).toISOString().split("T")[0]}.json`;u.downloadFile(e,t,"application/json")}},{id:"learning-history",title:"fï¿½et",description:"ï¿½Ã·ï¿½ï¿½Thnfï¿½2ï¿½CSVbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(c,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportLearningHistoryCSV(),t=`learning-history_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"monster-collection",title:"ï¿½ï¿½ï¿½ï¿½ì¯·ï¿½ï¿½",description:"rï¿½W_ï¿½ï¿½ï¿½n\0ï¿½ï¿½CSVbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(g,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportMonsterCollectionCSV(),t=`monster-collection_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"statistics",title:"q\bï¿½1",description:"fï¿½>nq\bï¿½ï¿½ï¿½ï¿½CSVbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(d,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportStatisticsCSV(),t=`statistics_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"daily-activity",title:"ï¿½%;ï¿½2",description:"ï¿½Thnfï¿½;Õ’CSVbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(p,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportDailyActivityCSV(),t=`daily-activity_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"content-stats",title:"ï¿½ï¿½ï¿½ï¿½ï¿½%q\b",description:"Shï¿½Vï¿½ï¿½Wï¿½ï¿½ï¿½c(ï¿½%n>ï¿½CSVbgï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",icon:t.jsx(x,{className:"text-2xl"}),format:"csv",action:()=>{const e=u.exportContentTypeStatsCSV(),t=`content-type-stats_${(new Date).toISOString().split("T")[0]}.csv`;u.downloadFile(e,t,"text/csv")}},{id:"backup",title:"ï¿½Ã¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½",description:"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½jbgï¿½Ã¯ï¿½ï¿½×’",icon:t.jsx(a,{className:"text-2xl"}),format:"json",action:()=>{const e=u.createBackup(),t=`kotodama-monster-backup_${(new Date).toISOString().split("T")[0]}.json`;u.downloadFile(e,t,"application/json")}}];return t.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-4xl mx-auto p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-800 mb-2 flex items-center",children:[t.jsx(a,{className:"mr-3 text-blue-600"}),"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½"]}),t.jsx("p",{className:"text-gray-600 mb-6",children:"fï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½n2Wï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Wfï¿½gï¿½W_ï¿½ï¿½XW_ï¿½gM~Y"}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:C.map(e=>t.jsxs(s.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"relative",children:[t.jsx("button",{onClick:()=>(async e=>{b(e.id);try{await new Promise(e=>setTimeout(e,500)),e.action(),v(t=>new Set([...t,e.id])),setTimeout(()=>{v(t=>{const s=new Set(t);return s.delete(e.id),s})},3e3)}catch(t){}finally{b(null)}})(e),disabled:null!==y,className:`w-full p-4 rounded-lg border-2 transition-all ${y===e.id?"border-blue-400 bg-blue-50":j.has(e.id)?"border-green-400 bg-green-50":"border-gray-200 hover:border-blue-300 hover:shadow-md bg-white"} ${null!==y&&y!==e.id?"opacity-50":""}`,children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"p-3 rounded-lg "+(y===e.id?"bg-blue-200 text-blue-700":j.has(e.id)?"bg-green-200 text-green-700":"bg-gray-100 text-gray-700"),children:y===e.id?t.jsx(i,{className:"text-2xl animate-spin"}):j.has(e.id)?t.jsx(r,{className:"text-2xl"}):e.icon}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h3",{className:"font-semibold text-gray-800",children:e.title}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),t.jsxs("span",{className:"inline-block mt-2 px-2 py-1 text-xs rounded "+("json"===e.format?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"),children:[e.format.toUpperCase(),"b"]})]})]})}),t.jsx(AnimatePresence,{children:j.has(e.id)&&t.jsx(s.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-2",children:t.jsx(r,{})})})]},e.id))}),t.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-blue-800 mb-2 flex items-center",children:[t.jsx(o,{className:"mr-2"}),"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½kdDf"]}),t.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[t.jsx("li",{children:"CSVbnÕ¡ï¿½ï¿½oExcelï¿½Googleï¿½ï¿½ï¿½ï¿½É·ï¿½ï¿½gï¿½OShLgM~Y"}),t.jsx("li",{children:"JSONbnÕ¡ï¿½ï¿½oï¿½ï¿½ï¿½ï¿½ï¿½gnï¿½ï¿½ï¿½Ã¯ï¿½ï¿½ï¿½kiWfD~Y"}),t.jsx("li",{children:"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Uï¿½_ï¿½ï¿½ï¿½ko\vï¿½ï¿½1o+~ï¿½~[ï¿½"}),t.jsx("li",{children:"ï¿½Ã¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½oenï¿½ï¿½ï¿½ï¿½ï¿½_ï¿½gï¿½Cï¿½ï¿½gY"})]})]})]})})};export{h as ExportScreen};
