# 2025-01-21 統計画面実装

## 実装概要
学習統計の詳細表示機能を実装し、グラフによる視覚的な進捗確認を可能にしました。

## 実装内容

### 1. チャートライブラリの導入
- **Recharts**を採用（React向けの軽量チャートライブラリ）
- `npm install recharts`でインストール

### 2. 型定義の追加
`src/types/index.ts`に以下の型を追加：
- `LearningHistory`: 日別学習履歴
- `LearningStats`: 統計データの集約

### 3. LearningHistoryManagerクラスの実装
`src/core/LearningHistoryManager.ts`を新規作成：

#### 主要機能
- **セッション管理**: 学習開始時にセッション開始、終了時に履歴保存
- **回答記録**: 各回答のコンテンツタイプと正誤を記録
- **統計計算**: 日別、週別、月別の統計データを自動計算
- **データ永続化**: localStorageに90日分の履歴を保存

#### データ構造
```typescript
- 日別履歴: 問題数、正解数、正答率、カテゴリ別成績、学習時間
- 週間統計: 総問題数、平均正答率、最も活発な曜日、総学習時間
- 月別トレンド: 過去6ヶ月の正答率と問題数の推移
- カテゴリ別パフォーマンス: 各コンテンツタイプの成績詳細
```

### 4. StatsScreenコンポーネント
`src/components/stats/StatsScreen.tsx`を新規作成：

#### 表示内容
1. **サマリーカード**: 週間正答率、問題数、学習時間、最も活発な曜日
2. **期間別表示**: 日別、週間、月別のタブ切り替え
3. **各種グラフ**:
   - 日別進捗（エリアチャート）
   - 正答率推移（ラインチャート）
   - カテゴリ別成績（円グラフ＆棒グラフ）
   - 月別トレンド（複合軸チャート）
4. **エクスポート機能**: 学習履歴をJSON形式でダウンロード

### 5. GameContextへの統合
`src/contexts/GameContext.tsx`を更新：
- ゲーム開始時にセッション開始
- 各回答時に履歴記録
- ウィンドウクローズ時にセッション終了

### 6. ナビゲーションの更新
- MainContent、Header、Footerに統計画面を追加
- 独立した統計画面へのアクセスを提供

## 技術的な実装詳細

### グラフコンポーネント
- **AreaChart**: 日別の問題数と正解数の推移
- **LineChart**: 正答率の推移
- **PieChart**: カテゴリ別問題数の割合
- **BarChart**: カテゴリ別正答率の比較

### パフォーマンス最適化
- 履歴データは90日分に制限
- グラフデータは表示期間に応じて集約
- ResponsiveContainerで自動リサイズ対応

### レスポンシブ対応
- モバイルでは縦並びレイアウト
- タッチ操作に対応したツールチップ
- 画面サイズに応じたグラフサイズ調整

## 視覚的な工夫
- グラデーションを使用した魅力的なサマリーカード
- コンテンツタイプごとに色分けされたグラフ
- アニメーション付きの数値表示
- 成績に応じた色分け（80%以上:緑、60%以上:黄、それ以下:赤）

## 今後の拡張可能性
1. 学習目標の設定と達成率表示
2. 他ユーザーとの比較機能
3. 詳細な学習レポートのPDF出力
4. 苦手分野の自動分析と推奨学習

## 関連ファイル
- `/src/types/index.ts`
- `/src/core/LearningHistoryManager.ts`
- `/src/components/stats/StatsScreen.tsx`
- `/src/contexts/GameContext.tsx`
- `/src/components/common/MainContent.tsx`
- `/src/components/common/Header.tsx`
- `/src/components/common/Footer.tsx`