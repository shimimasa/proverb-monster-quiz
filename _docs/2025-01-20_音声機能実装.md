# 2025-01-20 音声機能実装

## 実装内容

### 1. 音声サービスの作成
- **ファイル**: `src/services/audioService.ts`
- **機能**:
  - Web Speech APIによる日本語テキスト読み上げ
  - Web Audio APIによる効果音生成
  - 音量・速度調整機能
  - シングルトンパターンによる統一管理

### 2. 音声フックの作成
- **ファイル**: `src/hooks/useAudio.ts`
- **機能**:
  - GameContextの設定と連動
  - 読み上げ中の状態管理
  - 効果音再生のラッパー機能

### 3. UIコンポーネントへの統合
- **QuizScreen.tsx**:
  - 問題文の自動読み上げ
  - 読み上げボタン（再生/停止）
  - 正解/不正解時の効果音
  - レベルアップ・アチーブメント獲得時の効果音
- **ChoiceButtons.tsx**:
  - 選択肢クリック時の効果音

## 技術的な詳細

### Web Speech API
```typescript
// 日本語音声の選択
const voices = this.speechSynthesis!.getVoices();
const japaneseVoice = voices.find(voice => 
  voice.lang === 'ja-JP' || voice.lang.startsWith('ja')
);
```

### 効果音生成（Web Audio API）
各効果音をオシレーターで生成：

#### 正解音
- 周波数：523.25Hz（C5）→ 1046.5Hz（C6）
- 上昇する明るい音

#### 不正解音
- 周波数：300Hz → 150Hz
- 下降する低い音

#### レベルアップ音
- ファンファーレ風のメロディ
- C5、E5、G5、C6の連続音

#### アチーブメント音
- キラキラ音効果
- 高周波数の短い音を連続

#### モンスター獲得音
- 明るいメロディパターン
- C5、E5、C5、G5の組み合わせ

#### クリック音
- 1000Hzの短い音
- 0.05秒の持続時間

#### ホバー音
- 600Hzのサイン波
- 柔らかい音質

## 実装の特徴

### 1. 自動読み上げ機能
- 問題文が表示されたら自動で読み上げ開始
- 設定でON/OFF切り替え可能
- 回答後は自動的に停止

### 2. インタラクティブな読み上げ制御
- 読み上げボタンで再生/停止を切り替え
- 読み上げ中は停止アイコン表示
- アクセシビリティ対応（aria-label）

### 3. 状況に応じた効果音
- 正解/不正解で異なる音
- レベルアップ時の特別な音
- アチーブメント獲得時のキラキラ音
- モンスター獲得時の楽しい音

### 4. 設定との連動
- 設定画面でサウンドON/OFF
- 音量調整（0-100%）
- 設定はlocalStorageに保存

## アクセシビリティ対応

1. **スクリーンリーダー対応**
   - 適切なaria-label属性
   - ボタンの状態を明確に表示

2. **キーボード操作**
   - すべてのボタンがTabキーで選択可能
   - Enterキーで操作可能

3. **視覚的フィードバック**
   - 読み上げ中のアイコン変化
   - ホバー時の色変化

## ブラウザサポート

### Web Speech API
- Chrome: ✅ 完全対応
- Firefox: ✅ 対応
- Safari: ✅ 対応（iOS 7+）
- Edge: ✅ 対応

### Web Audio API
- すべての主要ブラウザで対応

## 実装の成果

1. **学習効果の向上**
   - 聴覚と視覚の両方で学習
   - 正しい読み方を音声で確認
   - 集中力を高める効果音

2. **アクセシビリティの向上**
   - 視覚に頼らない操作が可能
   - 読字困難な子どもへの配慮

3. **ゲーム体験の向上**
   - 効果音による達成感の演出
   - インタラクティブな操作感
   - 楽しい雰囲気の演出

## 今後の拡張案

1. **音声の種類追加**
   - 男性/女性の声の選択
   - 読み上げ速度の調整UI
   - キャラクターボイス

2. **効果音の拡充**
   - より多様な効果音パターン
   - 季節やイベント限定の音
   - BGMの追加

3. **録音機能**
   - 子どもの発音練習
   - 録音した音声の再生
   - 発音の比較機能