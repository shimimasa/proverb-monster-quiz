# 2025-01-20 アチーブメント獲得通知実装

## 実装内容

### 1. AchievementNotificationコンポーネントの作成
- **ファイル**: `src/components/common/AchievementNotification.tsx`
- **機能**:
  - アチーブメント獲得時のポップアップ通知表示
  - キューイングシステムによる複数通知の管理
  - 自動消去機能（5秒後）
  - アニメーション効果（Framer Motion）

### 2. 通知表示の特徴

#### ビジュアルデザイン
- **アイコンシステム**:
  - first_correct: チェックマーク
  - streak系: 炎アイコン
  - correct_10/50: 星アイコン
  - correct_100/500: トロフィーアイコン
  - accuracy_90: 脳アイコン
  - monsters系: ドラゴンアイコン

- **カラーシステム**:
  - レジェンダリー実績（500系、50系）: 黄色〜オレンジグラデーション
  - エピック実績（100系、20系）: 紫〜ピンクグラデーション
  - 正確性実績: 青〜シアングラデーション
  - モンスター実績: 緑〜エメラルドグラデーション
  - その他: グレーグラデーション

#### 表示機能
- **位置**: 画面右上に固定表示
- **最大表示数**: 3件まで同時表示
- **表示順序**: 獲得順にキューイング
- **アニメーション**:
  - スライドイン（右から左へ）
  - スライドアウト（左から右へ）
  - 段階的表示（0.1秒の遅延）
- **プログレスバー**: 残り表示時間を視覚化

### 3. GameContextの更新

#### 新規追加機能
- `clearAchievement`: 個別のアチーブメント通知をクリア
- アチーブメント重複チェックの改善:
  - 既に通知済みのアチーブメントを除外
  - アンロック時刻の検証（5秒以内）
  - Set構造を使用した効率的な重複チェック

### 4. MainContentへの統合
- AchievementNotificationコンポーネントの配置
- GameContextからの状態とアクションの取得
- Headerの下に配置し、z-indexで最前面表示

## 技術的な詳細

### 通知キューシステム
```typescript
// 2段階のキュー管理
const [notifications, setNotifications] = useState<NotificationItem[]>([]); // 待機キュー
const [displayQueue, setDisplayQueue] = useState<NotificationItem[]>([]);   // 表示キュー
```

### アニメーション設定
```typescript
// スプリングアニメーション
transition={{ 
  type: "spring", 
  stiffness: 200, 
  damping: 20,
  delay: index * 0.1 
}}
```

### 自動削除タイマー
```typescript
// 5秒後に自動削除
const timer = setTimeout(() => {
  setDisplayQueue(prev => prev.filter(n => n.id !== nextNotification.id));
  onClear(nextNotification.achievement.id);
}, 5000);
```

## 実装の成果

1. **優れたユーザー体験**
   - アチーブメント獲得の瞬間を見逃さない
   - 視覚的に魅力的な通知表示
   - 複数実績の同時獲得にも対応

2. **パフォーマンス最適化**
   - 最大3件の表示制限で画面の混雑を防止
   - 効率的なキューイングシステム
   - メモリリークを防ぐタイマー管理

3. **拡張性**
   - 新しいアチーブメントタイプの追加が容易
   - アイコンとカラーの追加が簡単
   - 通知表示時間の調整が可能

## 使用例

1. **初めての正解**
   - クイズに初めて正解すると通知が表示
   - チェックマークアイコンとグレーの背景

2. **連続正解**
   - 5問、10問、20問連続正解で通知
   - 炎のアイコンで達成感を演出

3. **累計正解数**
   - マイルストーン達成時に通知
   - レジェンダリーな実績には特別な色使い

## 次のステップ

1. **サウンド効果の追加**
   - 通知表示時の効果音
   - アチーブメントレベル別の音

2. **詳細表示モーダル**
   - 通知クリックで詳細情報表示
   - 獲得済み実績の一覧表示

3. **カスタマイズ機能**
   - 通知の表示位置選択
   - 表示時間の調整