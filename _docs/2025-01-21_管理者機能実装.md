# 2025-01-21 管理者機能実装

## 概要

ことだまモンスタークイズに管理者向けコンテンツ管理機能を実装しました。これにより、技術者以外でもコンテンツの追加・編集・削除が可能になり、運用の効率化と拡張性が向上しました。

## 実装内容

### 1. 管理者認証機能

#### AdminManager
- **認証機能**: 簡易的なパスワード認証（本番環境では適切なハッシュ関数使用推奨）
- **パスワード管理**: LocalStorageに保存（デフォルト: admin123）
- **パスワード変更**: 旧パスワードの確認後に変更可能

#### AdminContext
- **状態管理**: 管理者の認証状態を管理
- **ログイン/ログアウト**: 認証状態の更新
- **グローバルアクセス**: useAdmin hookでどこからでもアクセス可能

#### AdminLogin コンポーネント
- **セキュアな入力**: パスワード表示/非表示切り替え
- **遅延処理**: ブルートフォース対策として500msの遅延
- **エラー表示**: 認証失敗時のフィードバック

### 2. コンテンツ管理画面

#### AdminPanel
- **タブ型インターフェース**:
  - コンテンツ一覧: 既存コンテンツの表示・編集・削除
  - 新規追加: 新しいコンテンツの追加・編集
  - インポート/エクスポート: 一括操作

#### ContentForm
- **入力フィールド**:
  - テキスト（ことわざ/四字熟語/慣用句）
  - 読み方（ひらがな）
  - 意味
  - 難易度（小学生/中学生/高校生）
  - 例文（任意）
- **リアルタイムバリデーション**: 入力エラーの即時表示

#### ContentList
- **フィルター機能**:
  - タイプ別（ことわざ/四字熟語/慣用句）
  - 難易度別
  - テキスト検索
- **編集/削除**: カスタムコンテンツのみ操作可能
- **削除確認**: 誤操作防止のダイアログ

### 3. データバリデーション強化

#### バリデーション項目
- **必須フィールド**: テキスト、読み方、意味
- **文字数制限**:
  - テキスト: 100文字以内
  - 意味: 500文字以内
  - 例文: 500文字以内
- **形式チェック**:
  - 読み方: ひらがなのみ
  - 四字熟語: 漢字4文字
- **重複チェック**: 既存コンテンツとの重複防止

### 4. インポート/エクスポート機能

#### CSVインポート
- **フォーマット**: テキスト,読み方,意味,難易度,例文
- **エラー処理**: 行ごとのエラー詳細表示
- **テンプレート**: ダウンロード可能なCSVテンプレート
- **文字コード**: UTF-8推奨

#### JSONエクスポート
- **エクスポート単位**:
  - タイプ別エクスポート
  - 全データ一括エクスポート
- **フォーマット**: 整形されたJSON（インデント付き）

### 5. アクセス方法

#### 管理者パネルへのアクセス
1. **隠しコマンド**: フッターの著作権表示を5回クリック
2. **管理者ボタン**: ログイン後はフッターに管理者ボタンが表示
3. **パスワード入力**: デフォルトは「admin123」

## 技術的な詳細

### 型定義（types/admin.ts）
```typescript
interface AdminUser {
  isAuthenticated: boolean;
  lastLoginAt?: Date;
}

interface ContentFormData {
  id?: number;
  text: string;
  reading: string;
  meaning: string;
  difficulty: '小学生' | '中学生' | '高校生';
  example_sentence?: string;
  type: 'proverb' | 'idiom' | 'four_character_idiom';
}
```

### データ永続化
- **カスタムコンテンツ**: LocalStorageに保存（キー: custom_content）
- **管理者パスワード**: LocalStorageに保存（キー: admin_password_hash）
- **データ構造**: ContentType別に配列で管理

### セキュリティ対策
- パスワードのハッシュ化（簡易版、本番では要改善）
- 認証失敗時の遅延処理
- 管理者権限の確認

## UIの特徴

### レスポンシブデザイン
- モバイル対応のレイアウト
- タッチ操作に最適化
- スクロール可能なコンテンツエリア

### アニメーション
- Framer Motionによるスムーズな画面遷移
- モーダルの開閉アニメーション
- ホバーエフェクト

### アクセシビリティ
- キーボードナビゲーション対応
- ARIAラベルの適切な設定
- フォーカス管理

## 使用方法

### コンテンツの追加
1. 管理者パネルを開く
2. 「新規追加」タブを選択
3. フォームに必要情報を入力
4. 「追加」ボタンをクリック

### コンテンツの編集
1. 「コンテンツ一覧」タブで編集したい項目を検索
2. 編集ボタンをクリック
3. フォームで内容を修正
4. 「更新」ボタンをクリック

### 一括インポート
1. 「インポート/エクスポート」タブを選択
2. テンプレートをダウンロード
3. CSVファイルを作成
4. ファイルを選択してインポート

## 今後の改善案

### セキュリティ強化
- 適切なパスワードハッシュアルゴリズム（bcrypt等）
- セッション管理
- CSRF対策

### 機能拡張
- 画像アップロード機能
- バージョン管理（変更履歴）
- 複数管理者対応
- 権限レベルの設定

### UX改善
- ドラッグ&ドロップでのファイルアップロード
- 一括編集機能
- プレビュー機能
- 自動保存

## まとめ

管理者向けコンテンツ管理機能の実装により、以下が実現されました：

1. **運用効率化**: 技術者以外でもコンテンツ管理が可能
2. **拡張性向上**: 新しいコンテンツを簡単に追加
3. **データ品質**: バリデーションによる品質保証
4. **一括操作**: CSVインポート/JSONエクスポート

この機能により、ゲームコンテンツの継続的な更新と拡充が容易になりました。